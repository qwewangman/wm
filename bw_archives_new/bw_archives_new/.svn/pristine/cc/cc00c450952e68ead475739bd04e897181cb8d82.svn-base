<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>北京舞蹈学院学生档案管理系统</title>

    <link rel="stylesheet" type="text/css" href="__STATIC__/css/records.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/font/iconfont.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/css/style.css">

    <script src="__STATIC__/js/jquery-2.1.1.min.js"></script>
    <script src="__STATIC__/layui/layui.js" charset="utf-8"></script>
    <script src="__STATIC__/js/index.js"></script>
    <style>
        .layui-tab-title{position:relative;left:0;height:40px;white-space:nowrap;font-size:0;border-bottom-width:1px;border-bottom-style:solid;transition:all .2s;-webkit-transition:all .2s;width:500px;margin: 0 auto}
        .laytable-cell-2-id , .laytable-cell-3-id,.laytable-cell-4-id{
            display: none;
        }
    </style>
</head>
<body>
<div class="hederBox">
    <div class="fl_left logo">北京舞蹈学院学生档案管理系统</div>
    <div class="fl_right">
        <div class="fl_left user">管理员</div>
        <a href="{:url('/login_out')}"  style="color: white"><div class="fl_right signOut">退出</div></a>
        <div class="clear"></div>
    </div>
    <div class="clear"></div>
</div>
<div class="contetnBox">
    {include file='layout'}
    <div class="rightBox fl_right">
        <div class="titleBox">
            <div class="title fl_left">档案管理</div>
        </div>
        <div class="" style="background: white ; padding: 50px 30px;">
            <div style=" padding: 15px;margin-left: -10px;">
                    <a class="layui-btn layui-btn-primary" style="background: #f09c4e;border:none;color: #fff;" id="dy">打印</a>
                    <a class="layui-btn layui-btn-primary" style="background: #f09c4e;border:none;color: #fff;" id="batch_receive">批量接收</a>
                    <a class="layui-btn layui-btn-primary" style="background: #f09c4e;border:none;color: #fff;" id="batch_change">批量变动</a>
                <span style="float: right" >
                    <a class="layui-btn layui-btn-primary" style="background: #f09c4e;border:none;color: #fff;" href="{:url('/lijuan')}">立卷</a>
                    <a class="layui-btn layui-btn-primary" style="background: #f09c4e;border:none;color: #fff;" href="{:url('/addExcel')}">批量立卷</a>
                </span>
            </div>
<!------------------------------------------------------------------------------------------------------------------->
            <div class="layui-btn-group demoTable">

            </div>
            <div class="layui-tab-item layui-show">
                <form class="layui-form">
                    <div style="margin-left: -30px" class="demoTable">
                        <label class="layui-form-label">院系专业</label>
                        <div class="layui-input-inline">
                            <select name="courtyard" lay-filter="yx" id="courtyard">
                                <option value="" selected>请选择院系</option>
                                {foreach name='departlist' item='v'}
                                <option value="{$v.id}" >{$v.d_name}</option>
                                {/foreach}
                            </select>
                        </div>
                        <div class="layui-input-inline">
                            <select name="major"  id="zy">
                                <option value="">请选专业</option>
                            </select>
                        </div>
                        <div class="layui-form-mid layui-word-aux"></div>
                        姓名：
                        <div class="layui-inline">
                            <input class="layui-input" name="user_name" id="user_name" autocomplete="off">
                        </div>
                        卷号：
                        <div class="layui-inline">
                            <input class="layui-input" name="file_number" id="file_number" autocomplete="off">
                        </div>
                        <div class="layui-btn" data-type="reload" style="width: 100px">搜索</div>
                    </div>
                </form>
                <table class="layui-table"  id="LAY_table_user"  lay-data="{ url:'', page:true, id:'idTest'}" lay-filter="demo">
                </table>
                <script type="text/html" id="barDemo">
                    <a class="layui-btn layui-btn-xs" lay-event="edit">文件接收</a>
                    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">档案变动</a>
                    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="borrow">借阅记录</a>
                </script>
                <!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
                <script>
                    layui.use(['form', 'laydate','upload'], function(){
                        var form = layui.form;
                        form.on('select(yx)', function(data){
                            var str = '<option value="0">请选专业</option>';
                            var id = data.value; //院系id
                            $.post("{:url('/getZy')}",{id:id},function(res){
                                var length = res.length;
                                for (var i=0;i<length;i++) {
                                    str += '<option value="'+res[i].id+'">'+res[i].m_name+'</option>';
                                }
                                layui.$("#zy").html(str);
                                form.render();
                            },'json');
                        });
                    });
                    $('#batch_receive').click(function () {
                        if (idss != '' && idss != 'end'){
                            if (idss == 'all'){
                                var str = $(".laytable-cell-2-id").text();
                                var str1 = $(".laytable-cell-3-id").text();
                                idss = str == '' ? str1 : str;
                                var n_str = idss.replace("id","");
                                idss = n_str.split("").join(",");
                            }
                            var url = "{:url('/addFile')}?id="+idss;
                            window.location.href = url;
                        }else{
                            if (ids == ''){
                                layer.msg('请先选择案卷！！');
                                return false;
                            }
                            var url = "{:url('/addFile')}?id="+ids;
                            window.location.href = url;
                        }
                    });
                    $('#batch_change').click(function()
                    {
                        if(idss != '' && idss != 'end'){
                            if (idss == 'all'){
                                var str = $(".laytable-cell-2-id").text();
                                var str1 = $(".laytable-cell-3-id").text();
                                idss = str == '' ? str1 : str;

                                var n_str = idss.replace("id","");
                                idss = n_str.split("").join(",");
                            }
                            var url = "{:url('/BdCls')}?id="+idss;
                            window.location.href = url;
                        }else{
                            if (ids == ''){
                                layer.msg('请先选择案卷！！');
                                return false;
                            }
                            var url = "{:url('/BdCls')}?id="+ids;
                            window.location.href = url;
                        }
                    });
                    //打印按钮
                        layui.use('layer',function () {
                            var layer = layui.layer;
                            $('#dy').click(function()
                            {
                            if(idss != '' && idss != 'end'){
                                if (idss == 'all'){
                                    layer.msg('每次只能打印一份文件！！');
                                    return false;
                                }
                                var url = "{:url('/dyFile')}?dyid="+idss;
                                window.location.href = url;
                            }else{
                                if (ids == ''){
                                    layer.msg('请先选择案卷！！');
                                    return false;
                                }
                                if (ids.length > 1){
                                    layer.msg('每次打印一份！！');
                                    return false;
                                }
                                var url = "{:url('/dyFile')}?dyid="+ids;
                                window.location.href = url;
                            }
                            })
                        });
                    var ids =[];
                    var idss = '';
                    layui.use('table', function(){
                        var table = layui.table;
                        //监听表格复选框选择
                        table.on('checkbox(demo)', function(obj){
                            if(obj.checked == true)
                            {
                                if(obj.type == 'all'){
                                    idss = obj.type;
                                }
                                var k = ids.length;
                                ids[k]= obj.data.id;
                            }else{
                                if(obj.type == 'all'){
                                    idss = 'end';
                                }
                                var n = [];
                                var kk =0;
                                for(var i=0 ;i<ids.length ;i++)
                                {
                                    if(obj.data.id != ids[i])
                                    {
                                        n[kk] =ids[i];
                                        kk++
                                    }
                                }
                                ids = n;
                            }
                        });
//                  -------------------------------------------------------------------
//方法级渲染
                        table.render({
                            elem: '#LAY_table_user'
                            ,url: "{:url('/fileList')}" //数据接口
                            ,cols: [[  //表头
                                {checkbox: true, fixed: true}
                                ,{field:'filing_number', title: '入档号', width:184,fixed: true, sort:true}
                                ,{field:'user_name', title: '姓名', width:184}
                                ,{field:'file_number', title: '卷号',width:184}
                                ,{field:'addtime', title: '立卷日期', width:184}
                                ,{field:'num', title: '文件总数', width:184}
                                ,{field:'status', title: '状态', width:184}
                                ,{field:'url', title: '操作', width:374}
                            ]]
                            ,id: 'testReload'   //设定容器唯一ID
                            ,page:true  //开启分页
                        });
                        var $ = layui.$, active = {
                            reload: function(){
                                var courtyard = $('#courtyard');  //院系id
                                var zy = $('#zy');  //专业id
                                var sc_number = $('#sc_number'); //学号
                                var user_name = $('#user_name'); //姓名
                                var file_number = $('#file_number'); //卷号
                                //执行重载
                                table.reload('testReload', {
                                    page: {
                                        curr: 1 //重新从第 1 页开始
                                    }
                                    ,where: {   //设定异步数据接口的额外参数，任意设
                                        key: {
                                            courtyard: courtyard.val(),
                                            major: zy.val(),
                                            file_number:file_number.val(),
                                            sc_number: sc_number.val(),
                                            user_name: user_name.val()
                                        }
                                    }
                                });
                            }
                        };
//                               --------------------------------------------------------------------
// 监听工具条
                        table.on('tool(demo)', function(obj){
                            var data = obj.data;
                            var id = data.id;
                            if(obj.event === 'detail'){ //借阅
                                var url = "{:url('/updJys')}?id="+id;
                                window.location.href = url;
                            } else if(obj.event === 'del'){  //用户变动
                                var url = "{:url('/BdCl')}?id="+id;
                                window.location.href = url;
                            } else if(obj.event === 'edit'){  //文件接收
                                var url = "{:url('/details')}?id="+id;
                                window.location.href = url;
                            } else if(obj.event === 'jis'){
                                var url = "{:url('/addFile')}";
                                window.location.href = url;
                            } else if(obj.event === 'borrow'){ //借阅记录
                                var url = "{:url('/borrow')}?id="+id;
                                window.location.href = url;
                            }
                        });
                        $('.demoTable .layui-btn').on('click', function(){
                            var type = $(this).data('type');
                            active[type] ? active[type].call(this) : '';
                        });
                    });
                </script>










            <!------------------------------------------------------javascriptEnd------------------------------------------------------------->
        </div>
    </div>
</div>

</body>
</html>
