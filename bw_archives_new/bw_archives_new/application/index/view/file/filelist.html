
{include file='header' }
<style type="text/css">
    .layui-btn{
        height: 30px;
        line-height: 30px;
    }
    .layui-btn .layui-icon{
        font-size: 14px;
    }
    .layui-form-label{
        width: auto;
    }
    .btu-color{
        background: #f09c4e;border:none;color: #fff;
    }
    /*antiquewhite*/
    .anjuan{
        font-size: 14px;
        background: whitesmoke;
        font-family: "Songti SC";
        box-shadow: 2px 2px 5px #888888;
        cursor: pointer;
        border-radius: 5px;
    }
    .anjuan .jp{
        padding: 20px 15px;
        text-align: right;
    }
    .anjuan .jp span{
        padding: 5px;
        border: 1px solid #000;
    }
    .anjuan .name{
        text-align: center;
        font-size: 24px;
        padding: 0 10px;
        font-weight: bold;
    }
    .anjuan .wenj{
        padding: 10px 10px 0;
    }
    .anjuan .wenj .xiahua{
        padding: 0 5px;
    }
    .action{
        text-align: center;
        padding: 10px 0;
        border-top: 1px solid #000;
        margin-top: 10px;
        font-size: 14px;
    }
    .action a{
        padding: 0 5px;
    }
    .title1{
        font-weight: bold;
    }
    .layui-container{
        padding: 0 15px 0 0;
    }
    #pagediv{
        text-align: center;
    }
    #pagestyle{
        position: absolute;
        right: 50px;
        margin-top: -50px;
    }
    .thisstyle{
        background: bisque;
    }
</style>
<div class="contetnBox">
    {include file='layout' }
    <div class="rightBox fl_right">
        <div class="titleBox">
            <!--<div class="title fl_left">案卷管理</div>-->
        </div>
        <div class="" style="background: white ; padding: 15px;">

            <div class="layui-tab">

                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <form class="layui-form">
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">传感器名称</label>
                                    <div class="layui-input-inline">
                                        <input class="layui-input" name="name" id="name" autocomplete="off">

                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">传感器名称</label>
                                    <div class="layui-input-inline">
                                        <input class="layui-input" name="sc_number" id="sc_number" autocomplete="off">

                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">卷　号</label>
                                    <div class="layui-input-inline">
                                        <input class="layui-input" name="file_number" id="file_number" autocomplete="off">
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">身份证</label>
                                    <div class="layui-input-inline">
                                        <input class="layui-input" name="card" id="card" autocomplete="off">
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">手机号</label>
                                    <div class="layui-input-inline">
                                        <input class="layui-input" name="phone" id="phone" autocomplete="off">
                                    </div>
                                </div>

                                <div class="layui-inline">
                                    <label class="layui-form-label">年　级</label>
                                    <div class="layui-input-inline">
                                        <select name="grade" lay-filter="grade"  id="grade">
                                            <option value="" selected>请选择年级</option>
                                            {for start="(date('Y'))" end="1999" comparison="gt" step="-1"}
                                            <option value="{$i}" >{$i}级</option>
                                            {/for}
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">院　系</label>
                                    <div class="layui-input-inline">
                                        <select name="depart" lay-filter="yx" id="depart">
                                            <option value="" selected>请选择院系</option>
                                            {foreach name='departlist' item='v'}
                                            <option value="{$v.id}" >{$v.name}</option>
                                            {/foreach}
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">专　业</label>
                                    <div class="layui-input-inline">
                                        <select name="major"  id="zy">
                                            <option value="">请选专业</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">状　态</label>
                                    <div class="layui-input-inline">
                                        <select name="status" lay-filter="nj" id="status">
                                            <option value="-1" selected>请选择状态</option>
                                            <option value="0" >未接收</option>
                                            <option value="1">在档-正常</option>
                                            <option value="2">借出-外借</option>
                                            <option value="3">已迁出</option>
                                            <option value="4">已退档</option>
                                            <option value="5">转研究生</option>
                                            <option value="6">在档-毕业暂存</option>
                                            <option value="7">在档-村官暂存</option>
                                            <option value="8">借出-室内查阅</option>
                                            <option value="9">借出-在线查阅</option>
                                        </select>
                                    </div>
                                </div>


                            </div>

                            <div class="layui-form-item" style="text-align: center;">
                                <div class="layui-inline" style="margin-left: 9px">
                                    <a class="layui-btn layui-btn-primary btu-color"  href="javascript:void(0)" id="sch">
                                        <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>搜索
                                    </a>
                                    <a class="layui-btn layui-btn-primary "  href="{:url('/file/getlist')}">
                                        <i class="layui-icon layui-icon-refresh"></i>重置搜索
                                    </a>
                                    <a class="layui-btn layui-btn-primary "  href="JavaScript:void(0)" id="addfile">
                                        <i class="layui-icon layui-icon-add-1 "></i>立卷
                                    </a>
                                    <a class="layui-btn layui-btn-primary "  href="JavaScript:void(0)" id="uploadfile">
                                        <i class="layui-icon layui-icon-upload-drag layuiadmin-button-btn"></i>数据导入
                                    </a>
                                    <a class="layui-btn layui-btn-primary "  href="JavaScript:void(0)" id="ccwz">
                                        <i class="layui-icon layui-icon-list layuiadmin-button-btn"></i>生成存储位置
                                    </a>
                                    <!--<a class="layui-btn layui-btn-primary btu-color"  href="{:url('/addExcel')}">批量立卷</a>-->
                                </div>
                            </div>
                        </form>

                        <fieldset class="layui-elem-field layui-field-title">
                            <legend style="text-align:center">案卷列表</legend>
                        </fieldset>
                        <div id="pagestyle" >
                            <div class="layui-btn-group">
                                <a class="layui-btn layui-btn-primary layui-btn-sm thisstyle"  href="{:url('/file/getlist')}"  data-key="0" title="卡片">
                                    <i class="layui-icon">&#xe621;</i>
                                </a>
                                <a class="layui-btn layui-btn-primary layui-btn-sm" title="列表" href="{:url('/file/getlist')}?pagestyle=1" data-key="1">
                                    <i class="layui-icon">&#xe60a;</i>
                                </a>
                            </div>
                        </div>

                        <div class="layui-container">
                            <div class="layui-row layui-col-space20" id="condiv">

                            </div>
                        </div>

                        <div style="height: 20px"></div>
                        <div id="pagediv"></div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script id="datatpl" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <div class="layui-col-md3">
        <div class="anjuan">
            <div class="uinfo" data-id="{{ item.id }}" data-name="{{ item.name }}">
                <div class="jp"><span>卷号：{{ item.file_number }}</span></div>
                <div class="name">{{ item.name }}</div>
                <div class="wenj"><span class="title1">年　　级：</span><span class="xiahua">{{ item.grade }}级</span>　　性别：<span class="xiahua">{{ item.sex }}</span></div>
                <div class="wenj"><span class="title1">学　　号：</span><span class="xiahua">{{ item.sc_number }}</span></div>
                <div class="wenj"><span class="title1">院　　系：</span><span class="xiahua">{{ item.dname }}</span></div>
                <div class="wenj"><span class="title1">专　　业：</span><span class="xiahua">{{ item.mname }}</span></div>
                <div class="wenj"><span class="title1">存储位置：</span><span class="xiahua">{{ item.file_derice ==null?"":item.file_derice }}</span></div>
                <div class="wenj"><span class="title1">案卷状态：</span><span class="xiahua">{{ item.status }}</span></div>
                <div class="wenj"><span class="title1">文件总数：</span><span class="xiahua">{{ item.file_num }}</span></div>
                <div class="wenj"><span class="title1">立卷日期：</span><span class="xiahua">{{ item.addtime }}</span></div>
            </div>
            <div class="action">
                <a href="javascript:void(0)" class="print" data-id="{{ item.id }}" data-name="{{ item.name }}">
                    打印
                </a>
                <a href="javascript:void(0)" class="add" data-id="{{ item.id }}" data-name="{{ item.name }}">
                    添加
                </a>
                <a  href="javascript:void(0)" class="addchange" data-id="{{ item.id }}" data-name="{{ item.name }}">
                    变更
                </a>
                <span>|</span>
                <a href="javascript:void(0)" class="list" data-id="{{ item.id }}" data-name="{{ item.name }}">
                    文件
                </a>
                <a href="javascript:void(0)" class="change" data-id="{{ item.id }}" data-name="{{ item.name }}">
                    案卷
                </a>
            </div>
        </div>
    </div>
    {{#  }); }}
</script>
<script>
    var table;
    var count=1;
    var limit =  20;
    $(document).ready(function() {
        getDataFirst(1,limit);

    });

    $('#sch').click(function(){
        getDataFirst(1,limit);
    });
    
    function getDataFirst(curr,limit) {
        var depart      = $("#depart").val();
        var zy          = $("#zy").val();
        var file_number = $("#file_number").val();
        var sc_number   = $("#sc_number").val();
        var name        = $("#name").val();
        var card        = $("#card").val();
        var phone       = $("#phone").val();
        var grade       = $("#grade").val();
        var status      = $("#status").val();
        var batch      = $("#batch").val();

        $.get("{:url('/file/filelist')}", {
            page: curr,
            limit: limit,
            depart: depart,
            major: zy,
            file_number: file_number,
            sc_number: sc_number,
            name: name,
            card: card,
            phone: phone,
            grade: grade,
            status: status,
            batch: batch
        }, function (res) {
            if (res.code == 0) {
                count   = res.count;
                var data = res.data;
                var getTpl = datatpl.innerHTML, view = document.getElementById('condiv');

                layui.use(['laytpl'], function() {
                    var laytpl = layui.laytpl;
                    laytpl(getTpl).render(data, function (html) {
                        view.innerHTML = html;
                    });
                });

                layui.use(['laypage'], function() {
                    var laypage = layui.laypage;

                    laypage.render({
                        elem: 'pagediv'
                        ,count:count
                        ,limit:limit
                        ,layout: [ 'prev', 'page', 'next', 'skip']
                        ,jump: function(obj,first){
                            var curr =  obj.curr;
                            if(!first) {
                                getData(curr,limit);
                            }
                        }
                    });
                });
                initData();
            }
        }, 'json');
    }
    function getData(curr,limit) {
        var depart      = $("#depart").val();
        var zy          = $("#zy").val();
        var file_number = $("#file_number").val();
        var sc_number   = $("#sc_number").val();
        var name        = $("#name").val();
        var card        = $("#card").val();
        var phone       = $("#phone").val();
        var grade       = $("#grade").val();
        var status      = $("#status").val();
        $.get("{:url('/file/filelist')}", {
            page: curr,
            limit: limit,
            depart: depart,
            major: zy,
            file_number: file_number,
            sc_number: sc_number,
            name: name,
            card: card,
            phone: phone,
            grade: grade,
            status: status,
            batch:batch
        }, function (res) {
            if (res.code == 0) {
                var data = res.data;
                var getTpl = datatpl.innerHTML, view = document.getElementById('condiv');

                layui.use(['laytpl'], function() {
                    var laytpl = layui.laytpl;
                    laytpl(getTpl).render(data, function (html) {
                        view.innerHTML = html;
                    });
                });
                initData();
            }
        }, 'json');
    }

    function initData() {
        $(".print").click(function () {
            var id      = $(this).data("id");
            var name    = $(this).data("name");
            layer.open({
                type: 2,
                title:"打印预览-"+name,
                area: ['100%', '100%'],
                fixed: true, //不固定
                maxmin: false,
                scrollbar:false,
                shadeClose:true,
                content: "{:url('/file/print')}?stu_id="+id,
                anim:2
            });
        });

        $(".uinfo").click(function () {
            var id      = $(this).data("id");
            var name    = $(this).data("name");
            layer.open({
                type: 2,
                title:"案卷信息-"+name,
                area: ['80%', '100%'],
                fixed: true, //不固定
                maxmin: false,
                scrollbar:false,
                shadeClose:true,
                content: "{:url('/file/getone')}?id="+id,
                anim:2
            });
        });
        $(".list").click(function () {
            var id      = $(this).data("id");
            var name    = $(this).data("name");
            layer.open({
                type: 2,
                title:"文件列表-"+name,
                area: ['90%', '100%'],
                fixed: true, //不固定
                maxmin: false,
                scrollbar:false,
                shadeClose:true,
                content: "{:url('/file/file')}?stu_id="+id,
                anim:2
            });
        });
        $(".change").click(function () {
            var id      = $(this).data("id");
            var name    = $(this).data("name");
            var  index= layer.open({
                type: 2,
                title:"案卷变动历史-"+name,
                area: ['90%', '100%'],
                fixed: true, //不固定
                maxmin: false,
                scrollbar:false,
                shadeClose:true,
                content: "{:url('/file/change')}?stu_id="+id,
                anim:2
            });
        });
        $(".add").click(function () {
            var id      = $(this).data("id");
            var name    = $(this).data("name");
            layer.open({
                type: 2,
                title:"添加文件-"+name,
                area: ['60%', '100%'],
                fixed: true, //不固定
                maxmin: false,
                scrollbar:false,
                shadeClose:true,
                content: "{:url('/doc/adddoc')}?id="+id,
                anim:2
            });
        });

        $(".addchange").click(function () {
            var id      = $(this).data("id");
            var name    = $(this).data("name");
            layer.open({
                type: 2,
                title:"案卷变更-"+name,
                area: ['60%', '100%'],
                fixed: true, //不固定
                maxmin: false,
                scrollbar:false,
                shadeClose:true,
                content: "{:url('/file/changefile')}?id="+id,
                anim:2
            });
        });
    }


    layui.use(['form'], function(){
        var form = layui.form;
        form.on('select(yx)', function(data){
            var str = '<option value="">请选专业</option>';
            var id = data.value; //院系id
            if(id > 0)
            {
                $.post("{:url('/system/getzy')}",{id:id},function(res){
                    var length = res.length;
                    for (var i=0;i<length;i++) {
                        str += '<option value="'+res[i].id+'">'+res[i].name+'</option>';
                    }
                    layui.$("#zy").html(str);
                    form.render();
                },'json');
            }else{
                layui.$("#zy").html(str);
                form.render();
            }
        });
    });
    $("#addfile").click(function () {

        var index = layer.open({
            type: 2,
            title:"立卷",
            area: ['800px', '100%'],
            fixed: true, //不固定
            maxmin: false,
            scrollbar:false,
            shadeClose:false,
            content: "{:url('/file/add')}",
            anim:2,
            cancel: function(index, layero){
                layer.close(index);
                window.location.reload();
            }
        });
    });
    $("#uploadfile").click(function () {

        var index = layer.open({
            type: 2,
            title:"批量导入",
            area: ['600px', '90%'],
            fixed: true, //不固定
            maxmin: false,
            scrollbar:false,
            shadeClose:false,
            content: "{:url('/file/upload')}",
            anim:2,
            cancel: function(index, layero){
                layer.close(index);
                window.location.reload();
            }
        });
    });

    $("#ccwz").click(function () {

        var index = layer.open({
            type: 2,
            title:"生成存储位置",
            area: ['600px', '90%'],
            fixed: true, //不固定
            maxmin: false,
            scrollbar:false,
            shadeClose:false,
            content: "{:url('/file/ccwz')}",
            anim:2,
            cancel: function(index, layero){
                layer.close(index);
                window.location.reload();
            }
        });
    });
    $(".sliderList").removeClass("sliderLists");
    $("#slider2").addClass("sliderLists");
</script>
</body>
</html>
