<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>北京舞蹈学院学生档案管理系统</title>
    <link rel="stylesheet" type="text/css" href="__STATIC__/css/records.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/css/details.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/font/iconfont.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/css/style.css">


    <script src="__STATIC__/js/jquery-2.1.1.min.js"></script>
    <script src="__STATIC__/layui/layui.js" charset="utf-8"></script>
    <script src="__STATIC__/js/index.js"></script>
</head>
<style>
    .layui-btn-disableds{
        border: 1px solid #e6e6e6;
        background-color: #FBFBFB;
        color: #C9C9C9;
        cursor: not-allowed;
        opacity: 1;
        height: 28px;
        line-height: 28px;
        padding: 0 10px;
        font-size: 12px;
    }
</style>
<body>
<div class="hederBox">
    <div class="fl_left logo">北京舞蹈学院学生档案管理系统</div>
    <div class="fl_right">
        <div class="fl_left user">管理员</div>
        <a href="{:url('/login_out')}"  style="color: white"><div class="fl_right signOut">退出</div></a>
        <div class="clear"></div>
    </div>
    <div class="clear"></div>
</div>
<div class="contetnBox">
    {include file="layout"}
    <div class="rightBox fl_right">
        <div class="titleBox">
            <div class="title fl_left">{$user_info.file_number}</div>
            <a href="{:url('/ajgl')}"><div class="fl_right back">返回</div></a>
            <div class="clear"></div>
        </div>
        <div class="details">
            <div class="deTitle">
                <div class="tOne">
                    <div class="name">{$user_info.user_name}</div>
                    <div>&nbsp&nbsp&nbsp&nbsp</div>
                    <div class="state">{$user_info.status == 1 ? '<span style="font-size:14px;color: green"><span class="layui-badge-dot layui-bg-green"></span>&nbsp在档</span>' : '<span style="font-size:14px;color: red;"><span class="layui-badge-dot layui-bg-red"></span>&nbsp未收取</span>'}</div>
                </div>
            </div>
            <div class="deaBox">
                <div class="deaHead jn_text"><span>卷内文件</span></div>
                <div class="tableBox" style="border: 1px solid #e8e8e8;">
                    <div>
                        <table class="layui-hide" id="test">

                        </table>
                        <div class="addText"><button style="float: right" class="layui-btn layui-btn-normal layui-btn-radius" id="s">确定录入</button></div>
                    </div>
                    <input type="hidden" id="ids" value="{$user_info.id}"/>
                    <input type="hidden" id="infile" value="{$file_within}">
                    <script type="text/html" id="checkboxTpl">
                        <input type="checkbox" name="lock" value="{{d.id}}" title="接收" lay-filter="lockDemo" checked>
                    </script>
                </div>
                <script>
                    layui.use('table', function(){
                        var id = '';
                        function GetRequest() {
                            var url = location.search; //获取url中"?"符后的字串
                            var theRequest = new Object();
                            if (url.indexOf("?") != -1) {
                                var str = url.substr(1);
                                strs = str.split("&");
                                for(var i = 0; i < strs.length; i ++) {
                                    theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);
                                }
                            }
                            return theRequest;
                        }
                        $(document).ready(function () {
                            data = GetRequest();
                            if (data.id != null){
                                id = data.id;
                            }
                        });
                        var url = "{:url('/getShInside')}?id="+id;
                        var table = layui.table
                            ,form = layui.form;
                        table.render({
                            elem: '#test'
                            ,url: url
                            ,cols: [[
                                {field:'user_name', title:'姓名'}
                                ,{field:'within_number', title:'件号'}
                                ,{field:'lb_name', title:'文件类别', templet: '#usernameTpl'}
                                ,{field:'wh_name', title:'文件目录'}
                                ,{field:'within_time', title: '形成时间'}
                                ,{field:'within_num', title:'件数'}
                                ,{field:'page_num', title:'页数'}
                                ,{field:'lock', title:'操作', width:110, templet: '#checkboxTpl', unresize: true}
                            ]]
                            ,page: true
                        });
                        //监听性别操作
                        form.on('switch(sexDemo)', function(obj){
                            layer.tips(this.value + ' ' + this.name + '：'+ obj.elem.checked, obj.othis);
                        });
                        var standards = ''
                        //监听锁定操作
                        form.on('checkbox(lockDemo)', function(obj){
//                                    layer.tips(this.value + ' ' + this.name + '：'+ obj.elem.checked, obj.othis);
                            $("input:checkbox[name='lock']:checked").each(function() { // 遍历name=standard的多选框
                                standards += ',' + $(this).val();
                            });
                        });
                        var file_id = $("#infile").val();
                        if (standards == ''){
                            standards = file_id;
                        }
                        $('#s').click(function()
                        {
                            $.post("{:url('/sHenHe')}",{file_id:standards,user_id:id},function(res){
                                if(res.code == 1)
                                {
                                    alert('接收成功');
                                    location.href = "{:url('/ajgl')}";
                                }
                                form.render();
                            },'json');
                        })
                    });
                </script>
            </div>
        </div>
    </div>
    <div class="clear"></div>
</div>
</body>
</html>
