
{include file='header' }
<style type="text/css">
    .layui-btn{
        height: 30px;
        line-height: 30px;
    }
    .layui-btn .layui-icon{
        font-size: 14px;
    }
    .layui-form-label{
        width: auto;
    }
    .btu-color{
        background: #f09c4e;border:none;color: #fff;
    }
</style>
<div class="contetnBox">
    {include file='layout' }
    <div class="rightBox fl_right">
        <div class="titleBox">
            <div class="title fl_left">案卷管理</div>
        </div>
        <div class="" style="background: white ; padding: 15px;">

            <div class="layui-tab">

                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <form class="layui-form">
                            <div class="layui-form-item">


                                <div class="layui-inline">
                                    <label class="layui-form-label">姓名</label>
                                    <div class="layui-input-inline">
                                        <input class="layui-input" name="name" id="name" autocomplete="off">

                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">学号</label>
                                    <div class="layui-input-inline">
                                        <input class="layui-input" name="sc_number" id="sc_number" autocomplete="off">

                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">卷号</label>
                                    <div class="layui-input-inline">
                                        <input class="layui-input" name="file_number" id="file_number" autocomplete="off">
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">院系</label>
                                    <div class="layui-input-inline">
                                        <select name="depart" lay-filter="yx" id="depart">
                                            <option value="" selected>请选择院系</option>
                                            {foreach name='departlist' item='v'}
                                            <option value="{$v.id}" >{$v.name}</option>
                                            {/foreach}
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">专业</label>
                                    <div class="layui-input-inline">
                                        <select name="major"  id="zy">
                                            <option value="">请选专业</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-left: 9px">
                                    <a class="layui-btn layui-btn-primary btu-color"  href="javascript:void(0)" id="sch">
                                        <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>搜索
                                    </a>
                                    <a class="layui-btn layui-btn-primary btu-color"  href="JavaScript:void(0)" id="addfile">立卷</a>
                                    <a class="layui-btn layui-btn-primary btu-color"  href="{:url('/addExcel')}">批量立卷</a>
                                </div>
                            </div>


                        </form>
                        <table class="layui-hide" id="stu_table" lay-filter="stu_table">

                        </table>
                        <script type="text/html" id="doAction">
                            <div class="layui-btn-container">
                                <button class="layui-btn layui-btn-sm" lay-event="print">打印</button>
                            </div>
                        </script>
                        <script type="text/html" id="oneAction">
                            <a class="layui-btn layui-btn-xs" lay-event="fileChange">编辑</a>
                            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="fileCon">删除</a>
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <script>
        var table;
        layui.use('table', function(){
            table = layui.table;

            table.render({
                elem: '#stu_table'
                ,url:"{:url('/file/filelist')}"
                ,toolbar: '#doAction'
                ,defaultToolbar:['filter','exports']
                ,title: '用户数据表'
                ,cols: [[
                    {type: 'checkbox', fixed: 'left'}
                    ,{field:'file_number', width:120, fixed:true, title:'卷号'}
                    ,{field:'name', width:120,fixed:true, title:'姓名'}
                    ,{field:'sex', width:60 , title:'性别'}
                    ,{field:'sc_number', width:160, title:'学号'}
                    ,{field:'file_derice', width:100, title:'存放位置'}
                    ,{field:'dname', width:160, title:'系别'}
                    ,{field:'grade',width:80, title:'年级'}
                    ,{field:'addtime',width:120, title:'立卷日期'}
                    ,{field:'file_num', width:80, title:'文件数'}
                    ,{field:'status',width:120, title:'案卷状态'}
                    ,{fixed: 'right', toolbar: '#oneAction', width:150, title:'操作'}
                ]]
                ,page: true
                ,limit:10
                ,limits:[10,50,100]
            });
            table.on('toolbar(stu_table)', function(obj){
                switch(obj.event){
                    case 'print':
                        layer.msg('打印');
                        break;
                }
            });
            table.on('tool(stu_table)', function(obj){
                switch(obj.event){
                    case 'fileChange':
                        layer.open({
                            title: false
                            ,content: '可以填写任意的layer代码'
                            ,offset: 'r'
                            , area:['400px','100%']
                            , anim:-1
                            ,shadeClose:true
                            ,closeBtn:0
                            ,type:1
                        });
                        break;
                    case 'fileCon':
                        layer.msg('删除');
                        break;
                    case 'print':
                        layer.msg('打印');
                        break;
                    case 'showOne':
                        layer.open({
                            type: 2,
                            title:"学员信息",
                            area: ['800px', '100%'],
                            fixed: true, //不固定
                            maxmin: false,
                            scrollbar:false,
                            shadeClose:true,
                            content: "{:url('/file/getone')}?id="+obj.data.id,
                            anim:2
                        });
                        break;
                };
            });
        });
        layui.use(['form'], function(){
            var form = layui.form;
            form.on('select(yx)', function(data){
                var str = '<option value="">请选专业</option>';
                var id = data.value; //院系id
                if(id > 0)
                {
                    $.post("{:url('/system/getzy')}",{id:id},function(res){
                        var length = res.length;
                        for (var i=0;i<length;i++) {
                            str += '<option value="'+res[i].id+'">'+res[i].name+'</option>';
                        }
                        layui.$("#zy").html(str);
                        form.render();
                    },'json');
                }else{
                    layui.$("#zy").html(str);
                    form.render();
                }
            });
        });
        $('#sch').click(function(){
            var depart      = $("#depart").val();
            var zy          = $("#zy").val();
            var file_number = $("#file_number").val();
            var sc_number   = $("#sc_number").val();
            var name        = $("#name").val();
            table.reload('stu_table', {
                url:"{:url('/file/filelist')}"
                ,where: {depart:depart,major:zy,file_number:file_number,sc_number:sc_number,name:name} //设定异步数据接口的额外参数
            });
        });
        $("#addfile").click(function () {

            var index = layer.open({
                type: 2,
                title:"立卷",
                area: ['800px', '100%'],
                fixed: true, //不固定
                maxmin: false,
                scrollbar:false,
                shadeClose:false,
                content: "{:url('/file/add')}",
                anim:2,
                cancel: function(index, layero){
                    layer.close(index);
                    window.location.reload();
                }
            });
        });
        $(".sliderList").removeClass("sliderLists");
        $("#slider2").addClass("sliderLists");
    </script>
</body>
</html>
